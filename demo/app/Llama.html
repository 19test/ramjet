<section>
	<div class='intro'>
		<div class='stage' data-container='0'>
			<p data-stage='0'>Ramjet lets you transform one DOM element...</p>
		</div>

		<div class='stage' data-container='1'>
			<p data-stage='1'>...into another.</p>
		</div>

		<div class='stage' data-container='2'>
			<p data-stage='2'>It doesn't care where they sit in the DOM tree, or what children they have...</p>
		</div>

		<svg class='stage' data-container='3' viewBox='0 0 600 300'>
			<defs>
				<path id="MyPath"
				d="M 100 200
				C 200 100   400 100   500 200" />
			</defs>

			<!-- TODO text on a path -->
			<text data-stage='3'>
				<textPath xlink:href="#MyPath">
					...or whether they're HTML or SVG
				</textPath>
			</text>
		</svg>

		<div class='stage' data-container='4' data-stage='4'>
			<p>You can use images...</p>
			<img src='llama.jpg'>
		</div>

		<div class='stage' data-container='5' data-stage='5'>
			<p>...even animated ones</p>
			<img src='ramjetinpast.gif'>
		</div>
	</div>
</section>

<style>
	.intro {
		position: relative;
		width: 100%;
		height: 20em;
	}

	.stage {
		position: absolute;
		font-size: 2em;
	}

	[data-stage] {
		/*visibility: hidden;*/
		opacity: 0.1;
	}

	[data-stage].visible {
		/*visibility: visible;*/
		opacity: 1;
	}

	[data-container='0'] {
		left: 0;
		top: 0;
		width: 33.333%;
		height: 50%;
	}

	[data-container='1'] {
		left: 0;
		top: 50%;
		width: 33.333%;
		height: 50%;
	}

	[data-container='2'] {
		left: 33.333%;
		top: 50%;
		width: 66.666%;
		height: 50%;
	}

	[data-container='3'] {
		left: 33.333%;
		top: 0;
		width: 66.666%;
		height: 100%;
	}

	[data-container='4'] {
		right: 0;
		top: 0;
		width: 33.333%;
		height: 100%;
	}

	[data-container='5'] {
		right: 33.333%;
		top: 0;
		width: 33.333%;
		height: 100%;
	}

	.hidden {
		/*visibility: hidden;*/
		/*opacity: 0.1;*/
	}

	svg {
		height: 10em;
	}

	img {
		max-width: 100%;
	}
</style>

<script>
	const ramjet = require( './ramjet' );
	const tap = require( 'ractive-events-tap' );
	const eases = require( 'eases' );

	const Promise = Ractive.Promise;

	function loadImage ( url ) {
		return new Promise( ( fulfil, reject ) => {
			const img = new Image();

			img.onload = () => fulfil( img );
			img.onerror = reject;

			img.src = url;
		});
	}

	function wait ( ms ) {
		return new Promise( fulfil => {
			setTimeout( fulfil, ms );
		});
	}

	component.exports = {
		data: () => ({
			easingFunctions: Object.keys( eases ),
			easing: 'cubicOut',
			duration: 400,
			reverse: false,
			stage: 0
		}),

		onrender: function () {
			Promise.all([
				loadImage( 'llama.jpg' ),
				wait( 1000 )
			]).then( () => this.next() );

			this.find( `[data-stage='0']` ).classList.add( 'visible' );
		},

		next () {
			const currentStage = this.get( 'stage' );
			const nextStage = ( currentStage + 1 ) % 6;

			const a = this.find( `[data-stage='${currentStage}']` );
			const b = this.find( `[data-stage='${nextStage}']` );

			a.classList.add( 'visible' );
			b.classList.add( 'visible' );

			ramjet.transform( a, b, {
				easing: eases[ this.get( 'easing' ) ],
				duration: 400,
				done: () => {
					this.set( 'stage', nextStage );

					b.classList.add( 'visible' );

					setTimeout( () => {
						this.next();
					}, 1500 );
				}
			});

			a.classList.remove( 'visible' );
			b.classList.remove( 'visible' );
		},

		events: {
			tap
		}
	};
</script>